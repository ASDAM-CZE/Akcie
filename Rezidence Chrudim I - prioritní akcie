<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<title>Rezervační systém</title>
<style>
/* Základní layout */
body { font-family: Arial, sans-serif; padding: 20px; background:#fff; color:#111; }
.hidden { display: none; }

/* Brand / hlavička */
.brand {
  text-align: center;
  font-size: 2.6em;
  font-weight: 800;
  letter-spacing: .5px;
  margin: 18px 0 6px;
  color: #111;
  text-decoration: underline;
}
.subtitle {
  text-align: center;
  font-size: 1.05em;
  font-weight: 700;
  margin-bottom: 18px;
  color: #111;
  opacity: 0.95;
}

/* Login card */
#login-section {
  max-width: 520px;
  margin: 48px auto;
  padding: 36px;
  border: 1px solid #ddd;
  border-radius: 12px;
  background: #fff;
  box-shadow: 0 6px 18px rgba(0,0,0,0.04);
  font-size: 1.05em;
}
#login-section label { font-weight:600; display:block; margin-bottom:6px; }
#login-section input {
  width: 100%;
  padding: 12px;
  font-size: 1.05em;
  margin-bottom: 14px;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 8px;
}
#login-btn {
  width: 100%;
  padding: 14px;
  font-size: 1.15em;
  background: #111;
  color: white;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 700;
}
#login-btn:hover { filter: brightness(0.95); }

/* App section */
#app-section { max-width: 980px; margin: 18px auto; }

/* Seznam řádků */
.row {
  border: 1px solid rgba(0,0,0,0.06);
  padding: 10px;
  margin: 8px 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap:12px;
  border-radius:8px;
  background: rgba(0,0,0,0.02);
}

/* Barevné bloky podle stavu - světlejší, méně křiklavé */
.rezervovano { border-color: rgba(59,130,246,0.25); background: rgba(59,130,246,0.06); }
.prodano { border-color: rgba(34,197,94,0.22); background: rgba(34,197,94,0.05); }
.zaplaceno { border-color: rgba(250,204,21,0.18); background: rgba(250,204,21,0.04); }

/* Tlačítka a akce */
.actions button { margin-left: 6px; font-size: 1.02em; padding: 8px 12px; border: none; cursor: pointer; border-radius:6px; }
.badge { background: #eee; padding: 4px 8px; border-radius: 6px; font-weight:700; margin-right:8px; }
.muted { color: #666; font-size: 0.95em; }
.primary { background: #007bff; color: white; padding: 8px 12px; border-radius:6px; }
.sell-btn { background: #22c55e; color: #fff; }
.paid-btn { background: #facc15; color: #111; }
.cancel-btn { background: #ff0033; color: #fff; }

/* Prioritní text */
.row .muted.prio { margin-left: 8px; font-size:0.95em; color:#444; font-weight:600; }

/* Accordion pro moje rezervace - nadpisy výraznější a tmavší */
.accordion { margin-top: 10px; }
.acc-header {
  background: transparent;
  padding: 12px;
  cursor: pointer;
  border: 1px solid rgba(0,0,0,0.06);
  margin-top: 10px;
  font-size: 1.18em;
  font-weight: 800;
  display:flex;
  justify-content:space-between;
  align-items:center;
  color:#111;
  border-radius:8px;
}
.acc-header[data-target="rez"] { color:#0b3f9a; }
.acc-header[data-target="pro"] { color:#0f7a3a; }
.acc-header[data-target="zap"] { color:#a66f00; }

.acc-body.hidden { display: none; }
.acc-body { padding: 8px 6px; }

/* Hromadná tlačítka */
.bulk-actions { margin: 10px 0; }
.bulk-actions button { margin-right: 8px; font-size:1.05em; padding:8px 12px; border-radius:6px; }

/* Available header */
.available-header { display:flex; justify-content:space-between; align-items:center; margin:6px 0 10px; }
.available-actions { display:flex; gap:8px; }

/* Modal */
.modal.hidden { display:none; }
.modal { position: fixed; inset: 0; z-index: 9999; }
.modal-backdrop { position:absolute; inset:0; background: rgba(0,0,0,0.35); }
.modal-card {
  position: relative;
  max-width: 520px;
  margin: 8vh auto;
  background: #fff;
  border-radius: 12px;
  border: 1px solid #ddd;
  padding: 20px;
  box-shadow: 0 12px 32px rgba(0,0,0,0.18);
}
.modal-card h3 { margin: 0 0 6px; }
.modal-card .muted { display:block; margin-bottom:12px; }
.modal-card label { display:block; margin: 10px 0 6px; font-weight:600; }
.modal-card input[type="text"], .modal-card input[type="number"] {
  width:100%; padding:10px; box-sizing:border-box; font-size:1.02em; border-radius:8px; border:1px solid #ccc;
}
.modal-actions { display:flex; justify-content:flex-end; gap:8px; margin-top:14px; }
.modal-actions .cancel-btn { background:#777; color:#fff; }

/* Focus a drobnosti */
input[type="text"]:focus, input[type="number"]:focus { outline:none; border-color:#007bff; box-shadow:0 0 0 4px rgba(0,123,255,0.08); }
.primary:disabled { opacity:0.5; cursor:not-allowed; }

/* Responsivní */
@media (max-width:800px){
  .row { flex-direction: column; align-items:flex-start; gap:8px; }
  .row .actions { align-self:stretch; display:flex; gap:8px; justify-content:flex-end; width:100%; }
  #login-section { margin: 28px 12px; }
}
</style>
</head>
<body>

<!-- Brand a podnadpis -->
<h1 class="brand">Rezidence Chrudim I</h1>
<div class="subtitle">Prioritní akcie</div>

<!-- LOGIN -->
<div id="login-section">
  <h2 style="margin-top:0; font-size:1.25em; font-weight:800;">Přihlášení</h2>
  <div>
    <label for="login-name">Jméno</label>
    <input id="login-name" type="text" autocomplete="username" />
  </div>
  <div>
    <label for="login-password">Heslo</label>
    <input id="login-password" type="password" autocomplete="current-password" />
  </div>
  <button id="login-btn">Přihlásit</button>
  <div id="login-msg" class="error" style="color:#b00020; margin-top:8px;"></div>
</div>

<!-- APP -->
<div id="app-section" class="hidden">
  <h2>Vítejte, <span id="user-label"></span></h2>
  <button id="logout-btn" style="background:#111;color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;">Odhlásit</button>

  <h3 style="margin-top:18px;">Seznam akcií</h3>
  <div id="list"></div>
</div>

<div id="debug" style="margin-top:20px; color:#888;"></div>

<!-- MODAL: Hromadná rezervace -->
<div id="bulkReserveModal" class="modal hidden" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="brm-title">
  <div class="modal-backdrop" id="brm-backdrop"></div>
  <div class="modal-card" role="document">
    <h3 id="brm-title">Hromadná rezervace</h3>
    <span class="muted">Počet vybraných položek: <b id="brm-count">0</b></span>

    <label for="brm-customer">Jméno zákazníka</label>
    <input id="brm-customer" type="text" placeholder="Zadejte jméno zákazníka" />

    <label for="brm-price">Společná cena</label>
    <input id="brm-price" type="number" min="1000000" step="1000" inputmode="numeric" placeholder="1 000 000 Kč — za jednu akcii" />
    <small class="muted">Tato cena se použije pro všechny vybrané položky (Kč — za jednu akcii).</small>

    <div id="brm-msg" class="error" style="min-height:1.2em; margin-top:6px; color:#b00020;"></div>

    <div class="modal-actions">
      <button id="brm-cancel" class="cancel-btn" type="button">Zrušit</button>
      <button id="brm-submit" class="primary" type="button">Potvrdit rezervaci</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const debugEl = document.getElementById("debug");
  const listEl = document.getElementById("list");
  const loginSection = document.getElementById("login-section");
  const appSection = document.getElementById("app-section");
  const loginNameInput = document.getElementById("login-name");
  const loginPasswordInput = document.getElementById("login-password");
  const loginBtn = document.getElementById("login-btn");
  const loginMsg = document.getElementById("login-msg");
  const userLabel = document.getElementById("user-label");
  const logoutBtn = document.getElementById("logout-btn");

  // Modal prvky
  const brmEl = document.getElementById("bulkReserveModal");
  const brmCountEl = document.getElementById("brm-count");
  const brmCustomerEl = document.getElementById("brm-customer");
  const brmPriceEl = document.getElementById("brm-price");
  const brmMsgEl = document.getElementById("brm-msg");
  const brmCancelBtn = document.getElementById("brm-cancel");
  const brmSubmitBtn = document.getElementById("brm-submit");
  const brmBackdrop = document.getElementById("brm-backdrop");

  let currentTraderId = null;
  let currentTraderName = null;
  let currentIsAdmin = false;

  const debug = (txt) => { if (!debugEl) return; debugEl.textContent = txt; console.log(txt); };

  const supabase = window.supabase.createClient(
    "https://pureguxhuoskbrtavwkp.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB1cmVndXhodW9za2JydGF2d2twIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzODQzNjMsImV4cCI6MjA4NTk2MDM2M30.tc7zqlnGdlwooGFDaMOjGxTsl9RDVbQakeL_qajUlWc"
  );

  const formatCena = (c) => new Intl.NumberFormat("cs-CZ").format(c) + " Kč";

  function showLogin() {
    loginSection.classList.remove("hidden");
    appSection.classList.add("hidden");
    currentTraderId = null;
    currentTraderName = null;
    currentIsAdmin = false;
    loginPasswordInput.value = "";
  }

  function showApp() {
    loginSection.classList.add("hidden");
    appSection.classList.remove("hidden");
  }

  async function handleLogin() {
    const name = loginNameInput.value.trim();
    const password = loginPasswordInput.value.trim();
    loginMsg.textContent = "";

    if (!name || !password) {
      loginMsg.textContent = "Vyplňte prosím jméno i heslo.";
      return;
    }

    // Poznámka: původní implementace porovnávala heslo přímo v tabulce.
    // Zde zachováváme původní flow, ale kontrolujeme i jméno.
    const { data, error } = await supabase
      .from("traders")
      .select("id, is_admin")
      .eq("password", password)
      .eq("name", name)
      .eq("active", true)
      .limit(1)
      .maybeSingle();

    if (error) {
      console.error(error);
      loginMsg.textContent = "Chyba při přihlášení, zkuste to později.";
      return;
    }
    if (!data) {
      loginMsg.textContent = "Neplatné přihlašovací údaje.";
      return;
    }

    currentTraderId = data.id;
    currentTraderName = name;
    currentIsAdmin = data.is_admin === true;
    userLabel.textContent = currentTraderName;
    showApp();
    nacist();
  }

  async function zrusitStareRezervace() {
    const cutoff = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString();
    await supabase
      .from("items")
      .update({
        status: "K prodeji",
        reserved_by: null,
        reserved_for: null,
        reserved_at: null,
        paid: false
      })
      .lt("reserved_at", cutoff)
      .eq("status", "Rezervováno");
  }

  async function nacist() {
    debug("Načítám data…");
    listEl.textContent = "Načítám…";
    await zrusitStareRezervace();

    const { data, error } = await supabase
      .from("items")
      .select("id,priority_number,status,price,reserved_by,reserved_for,reserved_at,paid")
      .order("priority_number", { ascending: true });

    if (error) {
      console.error(error);
      listEl.textContent = "Chyba při načítání dat.";
      return;
    }

    const moje = currentIsAdmin ? data : data.filter(r => r.reserved_by === currentTraderName);
    vykresli(data, moje);
  }

  // Vrací vybrané id z dostupných položek
  function getSelectedAvailableIds() {
    const container = document.getElementById("available-list");
    if (!container) return [];
    return Array.from(container.querySelectorAll(".bulk:checked")).map(c => c.dataset.id);
  }

  function updateBulkReserveState() {
    const btn = document.getElementById("bulk-reserve");
    if (!btn) return;
    const count = getSelectedAvailableIds().length;
    btn.disabled = count === 0;
    btn.textContent = count > 0 ? `Hromadně rezervovat (${count})` : "Hromadně rezervovat";
  }

  function vykresli(data, moje) {
    let html = "";

    // Moje rezervace / Prodáno / Zaplaceno
    if (moje.length > 0) {
      let htmlRez = "";
      let htmlPro = "";
      let htmlZap = "";

      moje.forEach(r => {
        const trida = r.paid === true ? "zaplaceno" :
                      r.status === "Prodáno" ? "prodano" :
                      r.status === "Rezervováno" ? "rezervovano" : "";

        let tlacitka = "";
        if (r.paid === true) {
          tlacitka = "";
        } else if (r.status === "Prodáno") {
          tlacitka = `<button data-id="${r.id}" class="paid-btn">Zaplatit</button>`;
        } else if (r.status === "Rezervováno") {
          tlacitka = `
            <button data-id="${r.id}" class="sell-btn">Prodat</button>
            <button data-id="${r.id}" class="cancel-btn">Zrušit rezervaci</button>
          `;
        }

        const checkboxHtml = r.paid === true ? "" : `<input type="checkbox" class="bulk" data-id="${r.id}">`;

        // Badge + čl. X + text "prioritní akcie"
        const badgeWithText = `<span><span class="badge">#${r.id}</span><span class="muted prio">čl. ${r.id}</span><span class="muted prio" style="margin-left:10px;">prioritní akcie</span></span>`;

        const blok = `
          <div class="row ${trida}">
            <div style="display:flex; align-items:center; gap:8px;">
              ${checkboxHtml}
              ${badgeWithText}
            </div>
            <div style="flex:1;">
              <div class="muted">Cena: ${formatCena(r.price)}</div>
              <div class="muted">Zákazník: ${r.reserved_for || "-"}</div>
              <div class="muted">Rezervováno: ${r.reserved_at ? new Date(r.reserved_at).toLocaleString("cs-CZ") : "-"}</div>
              <div class="muted">Stav: ${r.status}</div>
            </div>
            <div class="actions">${tlacitka}</div>
          </div>
        `;

        if (r.paid === true) htmlZap += blok;
        else if (r.status === "Prodáno") htmlPro += blok;
        else htmlRez += blok;
      });

      html += `
        <h2>Moje rezervace (${moje.length})</h2>
        <div class="bulk-actions">
          <button id="bulk-sell" class="sell-btn">Hromadně prodat</button>
          <button id="bulk-paid" class="paid-btn">Hromadně zaplatit</button>
          <button id="bulk-cancel" class="cancel-btn">Hromadně zrušit</button>
        </div>

        <div class="accordion">
          <div class="acc-header" data-target="rez">Rezervované</div>
          <div id="rez" class="acc-body">${htmlRez || "<div class='muted'>Žádné rezervované položky.</div>"}</div>

          <div class="acc-header" data-target="pro">Prodáno</div>
          <div id="pro" class="acc-body hidden">${htmlPro || "<div class='muted'>Žádné prodané položky.</div>"}</div>

          <div class="acc-header" data-target="zap">Zaplaceno</div>
          <div id="zap" class="acc-body hidden">${htmlZap || "<div class='muted'>Žádné zaplacené položky.</div>"}</div>
        </div>
      `;
    }

    // Dostupné akcie + hromadná rezervace
    const dostupne = data.filter(r => r.status === "K prodeji");
    html += `
      <h2>Dostupné akcie (${dostupne.length})</h2>
      <div class="available-header">
        <div class="muted">Vyber položky, pak je hromadně rezervuj k jednomu zákazníkovi.</div>
        <div class="available-actions">
          <button id="bulk-reserve" class="primary" disabled>Hromadně rezervovat</button>
        </div>
      </div>
    `;

    let htmlAvail = "";
    dostupne.forEach(r => {
      htmlAvail += `
        <div class="row">
          <div style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" class="bulk" data-id="${r.id}">
            <span class="badge">#${r.id}</span>
            <span class="muted prio">čl. ${r.id}</span>
            <span class="muted prio" style="margin-left:8px;">prioritní akcie</span>
          </div>

          <div style="flex:1;">
            <div class="muted">Stav: ${r.status}</div>
          </div>

          <div><b>${formatCena(r.price)}</b></div>

          <div class="actions">
            <input type="number" min="1000000" step="1000" value="${r.price}" id="cena-${r.id}" style="width:140px; padding:6px; border-radius:6px; border:1px solid #ccc;" />
            <input type="text" placeholder="Jméno zákazníka" id="zakaznik-${r.id}" style="width:160px; padding:6px; border-radius:6px; border:1px solid #ccc;" />
            <button class="primary" data-id="${r.id}">Rezervovat</button>
          </div>
        </div>
      `;
    });

    html += `<div id="available-list">${htmlAvail || "<div class='muted'>Žádné dostupné položky.</div>"}</div>`;

    listEl.innerHTML = html;

    // Přidání event listenerů po vykreslení
    listEl.querySelectorAll(".sell-btn").forEach(btn => {
      btn.addEventListener("click", (e) => { e.preventDefault(); oznacitProdej(btn.dataset.id); });
    });
    listEl.querySelectorAll(".paid-btn").forEach(btn => {
      btn.addEventListener("click", (e) => { e.preventDefault(); oznacitZaplaceno(btn.dataset.id); });
    });
    listEl.querySelectorAll(".cancel-btn").forEach(btn => {
      btn.addEventListener("click", (e) => { e.preventDefault(); zrusitRezervaci(btn.dataset.id); });
    });
    listEl.querySelectorAll("button.primary").forEach(btn => {
      if (btn.id !== "bulk-reserve") {
        btn.addEventListener("click", (e) => { e.preventDefault(); rezervovat(btn.dataset.id); });
      }
    });

    // Accordion
    listEl.querySelectorAll(".acc-header").forEach(h => {
      h.addEventListener("click", () => {
        const body = document.getElementById(h.dataset.target);
        if (body) body.classList.toggle("hidden");
      });
    });

    // Hromadná tlačítka (moje rezervace)
    const bulkSellBtn = document.getElementById("bulk-sell");
    const bulkPaidBtn = document.getElementById("bulk-paid");
    const bulkCancelBtn = document.getElementById("bulk-cancel");
    if (bulkSellBtn) bulkSellBtn.addEventListener("click", bulkSell);
    if (bulkPaidBtn) bulkPaidBtn.addEventListener("click", bulkPaid);
    if (bulkCancelBtn) bulkCancelBtn.addEventListener("click", bulkCancel);

    // Hromadná rezervace dostupných
    const bulkReserveBtn = document.getElementById("bulk-reserve");
    if (bulkReserveBtn) bulkReserveBtn.addEventListener("click", (e) => { e.preventDefault(); openBulkReserveModal(); });

    const availableList = document.getElementById("available-list");
    if (availableList) {
      availableList.querySelectorAll("input.bulk").forEach(cb => {
        cb.addEventListener("change", updateBulkReserveState);
      });
      updateBulkReserveState();
    }
  }

  async function rezervovat(id) {
    const inputCena = document.getElementById("cena-" + id);
    const inputZakaznik = document.getElementById("zakaznik-" + id);
    const novaCena = parseInt(inputCena.value, 10);
    const zakaznik = (inputZakaznik.value || "").trim();

    if (!zakaznik) {
      alert("Zadejte jméno zákazníka.");
      return;
    }

    const { error } = await supabase
      .from("items")
      .update({
        status: "Rezervováno",
        price: novaCena,
        reserved_by: currentTraderName,
        reserved_for: zakaznik,
        reserved_at: new Date().toISOString()
      })
      .eq("id", id)
      .eq("status", "K prodeji");

    if (error) {
      console.error(error);
      alert("Rezervace selhala, zkuste to znovu.");
      return;
    }

    nacist();
  }

  async function oznacitProdej(id) {
    const { error } = await supabase
      .from("items")
      .update({ status: "Prodáno" })
      .eq("id", id);

    if (error) { console.error(error); alert("Operace selhala."); return; }
    nacist();
  }

  async function oznacitZaplaceno(id) {
    const { error } = await supabase
      .from("items")
      .update({ paid: true, status: "Zaplaceno" })
      .eq("id", id);

    if (error) { console.error(error); alert("Operace selhala."); return; }
    nacist();
  }

  async function zrusitRezervaci(id) {
    const { error } = await supabase
      .from("items")
      .update({
        status: "K prodeji",
        reserved_by: null,
        reserved_for: null,
        reserved_at: null,
        paid: false
      })
      .eq("id", id);

    if (error) { console.error(error); alert("Operace selhala."); return; }
    nacist();
  }

  function getSelectedIds(containerSelector) {
    const root = containerSelector ? document.querySelector(containerSelector) : document;
    if (!root) return [];
    return Array.from(root.querySelectorAll(".bulk:checked")).map(c => c.dataset.id);
  }

  async function bulkSell(e) {
    if (e && e.preventDefault) e.preventDefault();
    const ids = getSelectedIds("#rez");
    if (ids.length === 0) { alert("Nic není vybráno v sekci Rezervované."); return; }

    const { error } = await supabase.from("items").update({ status: "Prodáno" }).in("id", ids);
    if (error) { console.error(error); alert("Operace selhala."); return; }
    nacist();
  }

  async function bulkPaid(e) {
    if (e && e.preventDefault) e.preventDefault();
    const ids = getSelectedIds("#pro");
    if (ids.length === 0) { alert("Nic není vybráno v sekci Prodáno."); return; }

    const { error } = await supabase.from("items").update({ status: "Zaplaceno", paid: true }).in("id", ids);
    if (error) { console.error(error); alert("Operace selhala."); return; }
    nacist();
  }

  async function bulkCancel(e) {
    if (e && e.preventDefault) e.preventDefault();
    const ids = getSelectedIds("#rez");
    if (ids.length === 0) { alert("Nic není vybráno v sekci Rezervované."); return; }

    const { error } = await supabase.from("items").update({
      status: "K prodeji",
      reserved_by: null,
      reserved_for: null,
      reserved_at: null,
      paid: false
    }).in("id", ids);

    if (error) { console.error(error); alert("Operace selhala."); return; }
    nacist();
  }

  // Modal – otevření / zavření / submit
  function openBulkReserveModal() {
    const ids = getSelectedAvailableIds();
    if (ids.length === 0) return;
    brmCountEl.textContent = ids.length;
    brmCustomerEl.value = "";
    brmPriceEl.value = 1000000;
    brmPriceEl.placeholder = "1 000 000 Kč — za jednu akcii";
    brmMsgEl.textContent = "";
    brmEl.classList.remove("hidden");
    brmEl.setAttribute("aria-hidden", "false");
    // focus management
    setTimeout(() => brmCustomerEl.focus(), 50);
  }

  function closeBulkReserveModal() {
    brmEl.classList.add("hidden");
    brmEl.setAttribute("aria-hidden", "true");
    // vrátit focus na tlačítko bulk-reserve pokud existuje
    const br = document.getElementById("bulk-reserve");
    if (br) br.focus();
  }

  async function submitBulkReserve() {
    const ids = getSelectedAvailableIds();
    if (ids.length === 0) { brmMsgEl.textContent = "Není vybrána žádná položka."; return; }

    const zakaznik = (brmCustomerEl.value || "").trim();
    const cena = parseInt(brmPriceEl.value, 10);

    if (!zakaznik) { brmMsgEl.textContent = "Zadejte jméno zákazníka."; return; }
    if (!cena || isNaN(cena) || cena <= 0) { brmMsgEl.textContent = "Zadejte platnou cenu."; return; }

    brmMsgEl.textContent = "";
    brmEl.classList.add("processing");

    const { error } = await supabase
      .from("items")
      .update({
        status: "Rezervováno",
        price: cena,
        reserved_by: currentTraderName,
        reserved_for: zakaznik,
        reserved_at: new Date().toISOString()
      })
      .in("id", ids)
      .eq("status", "K prodeji");

    brmEl.classList.remove("processing");
    if (error) {
      console.error(error);
      brmMsgEl.textContent = "Rezervace selhala, zkuste to znovu.";
      return;
    }

    closeBulkReserveModal();
    nacist();
  }

  // Modal eventy
  brmCancelBtn.addEventListener("click", (e) => { e.preventDefault(); closeBulkReserveModal(); });
  brmBackdrop.addEventListener("click", (e) => { e.preventDefault(); closeBulkReserveModal(); });
  brmSubmitBtn.addEventListener("click", (e) => { e.preventDefault(); submitBulkReserve(); });

  // ESC zavření modalu
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && !brmEl.classList.contains("hidden")) {
      closeBulkReserveModal();
    }
  });

  // Login events
  loginBtn.addEventListener("click", (e) => { e.preventDefault(); handleLogin(); });
  loginPasswordInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") { e.preventDefault(); handleLogin(); }
  });

  logoutBtn.addEventListener("click", () => {
    showLogin();
    listEl.textContent = "";
  });

  showLogin();
});
</script>
</body>
</html>

