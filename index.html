<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dostupné akcie</title>

  <style>
    body {
      font-family: system-ui, -apple-system, Arial, sans-serif;
      margin: 0;
      background: #fff;
    }
    .wrap {
      max-width: 720px;
      margin: 60px auto;
      padding: 0 16px;
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 260px;
      font-size: 14px;
    }
    .row {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 12px;
      margin: 12px 0;
      text-align: left;
    }
    .muted {
      color: #666;
      font-size: 14px;
    }
    .debug {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 10px;
      margin: 15px auto;
      max-width: 600px;
      text-align: left;
      font-size: 14px;
      background: #fafafa;
    }
    button {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      cursor: pointer;
      margin-right: 6px;
    }
  </style>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
  <div class="wrap">
    <h1>Dostupné akcie</h1>

    <div style="margin-bottom:20px;">
      <label>Jméno obchodníka:</label><br />
      <input id="user" placeholder="např. Petr" />
    </div>

    <div id="debug" class="debug">HTML OK</div>
    <div id="list" class="muted">Načítám…</div>
  </div>

  <!-- JS MUSÍ BĚŽET AŽ PO DOM -->
  <script defer>
    document.addEventListener("DOMContentLoaded", () => {

      const dbg = (msg) => {
        document.getElementById("debug").textContent = msg;
        console.log("[DBG]", msg);
      };

      dbg("1) JS start – DOM ready");

      if (!window.supabase) {
        dbg("STOP: Supabase knihovna se nenačetla");
        return;
      }

      dbg("2) Supabase knihovna OK");

      const supabase = window.supabase.createClient(
        "https://pureguxhuoskbrtavwkp.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB1cmVndXhodW9za2JydGF2d2twIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzODQzNjMsImV4cCI6MjA4NTk2MDM2M30.tc7zqlnGdlwooGFDaMOjGxTsl9RDVbQakeL_qajUlWc"
      );

      dbg("3) Supabase client vytvořen");

      function render(items) {
        const el = document.getElementById("list");

        if (!items || items.length === 0) {
          el.textContent = "Žádná data.";
          return;
        }

        el.innerHTML = `<div class="muted">Načteno řádků: ${items.length}</div>`;

        items
          .filter(i => i.status !== "sold")
          .forEach(i => {
            el.innerHTML += `
              <div class="row">
                <strong>${i.symbol}</strong> – ${i.name}<br>
                <span class="muted">stav: ${i.status || "open"}</span>
              </div>
            `;
          });
      }

      async function load() {
        dbg("4) SELECT start");
        document.getElementById("list").textContent = "Načítám…";

        const { data, error } = await supabase
          .from("items")
          .select("*")
          .order("id");

        if (error) {
          dbg("CHYBA SELECT: " + error.message);
          document.getElementById("list").textContent = "CHYBA: " + error.message;
          return;
        }

        dbg("5) SELECT OK – řádků: " + data.length);
        render(data);
      }

      load();
    });
  </script>
</body>
</html>
